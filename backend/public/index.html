
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Avezzano Plus</title>
  <style>
    body { font-family: sans-serif; background: #f9f9f9; margin: 0; padding: 0; }
    header { background: #007bff; color: white; padding: 1rem; text-align: center; }
    #chat { height: 400px; overflow-y: scroll; border: 1px solid #ccc; padding: 1rem; background: white; }
    #users-online { font-size: 0.9rem; color: #555; margin: 1rem; }
    input, button { padding: 0.5rem; margin: 0.5rem; }
  </style>
</head>
<body>
  <header>Avezzano Plus – Chat Pubblica</header>
  <div id="users-online">Utenti online: <span id="online-count">0</span></div>
  <div id="chat"></div>
  <input id="msg" placeholder="Scrivi il tuo messaggio" maxlength="240" />
  <button onclick="sendMessage()">Invia</button>

  <script>
    // === Username setup ===
    let username = localStorage.getItem("username");

    while (!username || !/^[A-ZÀ-ÿ][a-zà-ÿ]+ [A-ZÀ-ÿ][a-zà-ÿ]+$/.test(username)) {
      username = prompt("Inserisci nome e cognome reali (es: Mario Rossi):");
      if (!username) continue;
      username = username.trim().replace(/\s+/g, " ");
      if (/^[A-ZÀ-ÿ][a-zà-ÿ]+ [A-ZÀ-ÿ][a-zà-ÿ]+$/.test(username)) {
        localStorage.setItem("username", username);
        break;
      } else {
        alert("Inserisci un nome e cognome validi (solo lettere, no numeri o caratteri speciali).");
      }
    }

    const socket = new WebSocket("wss://" + window.location.host); // wss = WebSocket sicuro
    const chat = document.getElementById("chat");
    const input = document.getElementById("msg");
    const online = document.getElementById("online-count");

    socket.onmessage = (event) => {
      const data = JSON.parse(event.data);
      if (data.type === "chat") {
        const p = document.createElement("p");
        p.textContent = data.user + ": " + data.message;
        chat.appendChild(p);
        chat.scrollTop = chat.scrollHeight;
      } else if (data.type === "online") {
        online.textContent = data.count;
      }
    };

    function sendMessage() {
      if (input.value.trim() !== "") {
        socket.send(JSON.stringify({ type: "chat", user: username, message: input.value }));
        input.value = "";
      }
    }
  </script>
</body>
</html>



