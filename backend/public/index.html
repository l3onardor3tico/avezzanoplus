
<div id="users-online" style="cursor:pointer; color:blue; text-decoration:underline;">
  Utenti online: <span id="online-count">0</span>
</div>
<div id="online-list" style="display:none; background:#fff; border:1px solid #ccc; padding:10px; max-width:300px;">
  <h4>Lista utenti online</h4>
  <ul id="user-list"></ul>
</div>

<script>
let onlineUsers = [];

socket.onmessage = (event) => {
  const data = JSON.parse(event.data);
  if (data.type === "chat") {
    const p = document.createElement("p");
    p.innerHTML = `<img src="${data.profilePic}" style="width:24px;height:24px;border-radius:50%;"> <b>${data.user}</b>: ${data.message}`;
    chat.appendChild(p);
    chat.scrollTop = chat.scrollHeight;
  } else if (data.type === "online") {
    online.textContent = data.count;
    onlineUsers = data.users || [];
  }
};

document.getElementById("users-online").onclick = () => {
  const listDiv = document.getElementById("online-list");
  const listEl = document.getElementById("user-list");
  listEl.innerHTML = "";
  onlineUsers.forEach(u => {
    const li = document.createElement("li");
    li.innerHTML = `<img src="${u.profilePic}" style="width:24px;height:24px;border-radius:50%;"> ${u.username}`;
    listEl.appendChild(li);
  });
  listDiv.style.display = listDiv.style.display === "none" ? "block" : "none";
};
</script>

